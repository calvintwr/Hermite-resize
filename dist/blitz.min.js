!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Blitz=t()}}(function(){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}var e={resize:function(e,a){if("object"!=t(e))throw Error("You need to provide options for Blitz as a `object`.");for(var o=this,r=["source","width","height"],i=0;i<r.length;i++){var n=r[i];if(void 0===e[n])throw Error("#resize() is expecting mandatory param `"+n+"`.")}if("function"!=typeof a)throw Error("#resize() is expecting `callback` to be a function.");var u,s,c=this._extract(e.source),f=this._mimeConverter(e.outputFormat);if(e.outputFormat=e.mimeType=f,"CANVAS"===c.type)u=c.source;else if("IMG"===c.type)u=this._imageToCanvas(c.source);else{if("DATA"===c.type)return e.output||(e.output="data"),this._dataToCanvas(c.source,e,a);if("FILE"===c.type)return e.output||(e.output="file"),this._fileToCanvas(c.source,e,a)}if(!u)throw Error("Unable to detect source type.");e.logPerformance&&(s=Date.now());var d=u.width,l=u.height,g=Math.round(e.width),p=Math.round(e.height),m=u.getContext("2d").getImageData(0,0,d,l),h=u.getContext("2d").getImageData(0,0,g,p);u.getContext("2d").clearRect(0,0,d,l);var v=new Worker(this._workerBlobURL(e.filter));v.onmessage=function(t){var r,i=t.data.data;if(e.logPerformance&&console.log("Resize completed in "+Math.round(Date.now()-s)/1e3+"s"),u.getContext("2d").clearRect(0,0,g,p),u.height=p,u.width=g,u.getContext("2d").putImageData(i,0,0),"canvas"===e.output)r=u;else if(["image","data"].indexOf(e.output)>-1)r=o._canvasToImageOrData(u,e.mimeType,e.quality,e.output);else if("file"===e.output)r=o._canvasToFile(u,e.mimeType,e.quality,e.output);else if("blob"===e.output)r=o._canvasToBlob(u,e.mimeType,e.quality,e.output);else if("download"===e.output)r=o._download(o,u,e);else{if(void 0!==e.output)throw Error("`output` is not valid.");var n;if("DATA"===c.type?n="data":"IMG"===c.type&&(n="image"),n)return o._canvasToImageOrData(u,e.mimeType,e.quality,n);r=u}a(r)},v.postMessage([m,d,l,g,p,h])},create:function(t){if(!t||"promise"===t){var e=(a=Object.create(this)).resize.bind(a);return function(t){return new Promise(function(a,o){try{e(t,function(t){a(t)})}catch(r){o(r)}})}}var a;if("callback"===t)return(a=Object.create(this)).resize.bind(a)},_extract:function(t){if(t instanceof File)return{source:t,type:"FILE"};if("string"==typeof t&&0===t.indexOf("data"))return{source:t,type:"DATA"};if(t.tagName)return{source:t,type:t.tagName};if(t[0].tagName)return{source:t[0],type:t[0].tagName};throw Error("#resize() found `source` element to be invalid.")},_imageToCanvas:function(t){var e=document.createElement("canvas"),a=e.getContext("2d");return e.height=t.height,e.width=t.width,a.drawImage(t,0,0,t.width,t.height),e},_dataToCanvas:function(t,e,a){var o=new Image,r=this;o.src=t,o.onload=function(){var t=document.createElement("canvas"),i=t.getContext("2d");t.height=o.height,t.width=o.width,i.drawImage(o,0,0,o.width,o.height),e.output=e.output?e.output:"data",e.source=t,r.resize(e,a)}},_fileToCanvas:function(t,e,a){var o=this,r=new FileReader;r.onload=function(t){e.source=t.target.result,e.output||(e.output="file"),o.resize(e,a)},r.readAsDataURL(t)},_canvasToImageOrData:function(t,e,a,o){var r,i=t.toDataURL(e,a);return"data"===o?r=i:(r=new Image).src=t.toDataURL(e,a),r},_canvasToBlob:function(t,e,a,o){var r=this._canvasToImageOrData(t,e,a,"data");return this._dataURItoBlob(r)},_canvasToFile:function(t,e,a,o){console.log(e);var r=this._canvasToBlob(t,e,a);return new File([r],"resized",{type:e,lastModified:Date.now()})},_dataURItoBlob:function(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var a=t.split(",")[0].split(":")[1].split(";")[0],o=new Uint8Array(e.length),r=0;r<e.length;r++)o[r]=e.charCodeAt(r);return new Blob([o],{type:a})},_mimeConverter:function(t){if(void 0===t)return"image/png";var e=["raw","png","jpg","gif","image/raw","image/png","image/jpg","image/gif"].indexOf(t);if(-1===e)throw Error("#inputImage() outputType can only be `raw`, `png`, `jpg` or `gif`");return 0===e||1===e?"image/png":2===e?"image/jpg":3===e?"image/gif":t},_download:function(t,e,a){return function(){var o=document.createElement("a");o.href=t._canvasToImageOrData(e,a.mimeType,a.quality,"data"),o.download="resized",document.body.appendChild(o),o.click(),document.body.removeChild(o)}},_workerBlobURL:function(t){t&&(t=this["_filter_"+t]),t||(t=this._filter_hermite);var e=this._workerTaskString(t);return window.URL.createObjectURL(new Blob([e],{type:"application/javascript"}))},_workerTaskString:function(t){var e="";return e+="(",e+="function () {",e+="    onmessage = function (event) {",e+="        var filter = ",e+=t.toString(),e+="        ;var resized = filter(event)",e+="        ;postMessage({data: resized });",e+="    };",(e+="}")+")()"},_filter_hermite:function(t){for(var e=t.data[0].data,a=t.data[1],o=t.data[2],r=t.data[3],i=t.data[4],n=t.data[5],u=n.data,s=a/r,c=o/i,f=Math.ceil(s/2),d=Math.ceil(c/2),l=0;l<i;l++)for(var g=0;g<r;g++){for(var p=4*(g+l*r),m=0,h=0,v=gx_g=gx_b=gx_a=0,y=(l+.5)*c,w=Math.floor(l*c);w<(l+1)*c;w++)for(var b=Math.abs(y-(w+.5))/d,_=(g+.5)*s,T=b*b,x=Math.floor(g*s);x<(g+1)*s;x++){var C=Math.abs(_-(x+.5))/f,I=Math.sqrt(T+C*C);I>=-1&&I<=1&&(m=2*I*I*I-3*I*I+1)>0&&(v+=m*e[C=4*(x+w*a)],gx_g+=m*e[C+1],gx_b+=m*e[C+2],gx_a+=m*e[C+3],h+=m)}u[p]=v/h,u[p+1]=gx_g/h,u[p+2]=gx_b/h,u[p+3]=gx_a/h}return n}};return Object.create(e)});