!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Blitz=t()}}(function(){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}var e={resize:function(e,a){if("object"!=t(e))throw Error("You need to provide options for Blitz as a `object`.");for(var r=this,o=["source","width","height"],n=0;n<o.length;n++){var i=o[n];if(void 0===e[i])throw Error("#resize() is expecting mandatory param `"+i+"`.")}if("function"!=typeof a)throw Error("#resize() is expecting `callback` to be a function.");var u,f,c=this._extract(e.source),d=this._mimeConverter(e.outputFormat);if(e.outputFormat=d,"CANVAS"===c.type)u=c.source;else if("IMG"===c.type)u=this._imageToCanvas(c.source);else{if("DATA"===c.type)return e.output||(e.output="data"),this._dataToCanvas(c.source,e,a);if("FILE"===c.type)return e.output||(e.output="file"),this._fileToCanvas(c.source,e,a)}if(!u)throw Error("Unable to detect source type.");e.logPerformance&&(f=Date.now());var s=u.width,g=u.height,p=Math.round(e.width),l=Math.round(e.height),m=u.getContext("2d").getImageData(0,0,s,g),h=u.getContext("2d").getImageData(0,0,p,l);u.getContext("2d").clearRect(0,0,s,g);var v=new Worker(this._workerBlobURL(e.filter));v.onmessage=function(t){var o=t.data.data;if(e.logPerformance&&console.log("Resize completed in "+Math.round(Date.now()-f)/1e3+"s"),u.getContext("2d").clearRect(0,0,p,l),u.height=l,u.width=p,u.getContext("2d").putImageData(o,0,0),"canvas"===e.output)return a(u);if(!(["image","data"].indexOf(e.output)>-1)){if("file"===e.output)return a(r._download(r,u,e));var n;if(void 0===e.output)return"DATA"===c.type?n="data":"IMG"===c.type&&(n="image"),n?r._canvasToImageOrData(u,e.mimeType,e.quality,n,a):a(u);throw Error("`output` is not valid.")}r._canvasToImageOrData(u,e.mimeType,e.quality,e.output,a)},v.postMessage([m,s,g,p,l,h])},create:function(t){if(!t||"promise"===t){var e=(a=Object.create(this)).resize.bind(a);return function(t){return new Promise(function(a,r){try{e(t,function(t){a(t)})}catch(o){r(o)}})}}var a;if("callback"===t)return(a=Object.create(this)).resize.bind(a)},_extract:function(t){if(t instanceof File)return{source:t,type:"FILE"};if("string"==typeof t&&0===t.indexOf("data"))return{source:t,type:"DATA"};if(t.tagName)return{source:t,type:t.tagName};if(t[0].tagName)return{source:t[0],type:t[0].tagName};throw Error("#resize() found `source` element to be invalid.")},_imageToCanvas:function(t){var e=document.createElement("canvas"),a=e.getContext("2d");return e.height=t.height,e.width=t.width,a.drawImage(t,0,0,t.width,t.height),e},_dataToCanvas:function(t,e,a){var r=new Image,o=this;r.src=t,r.onload=function(){var t=document.createElement("canvas"),n=t.getContext("2d");t.height=r.height,t.width=r.width,n.drawImage(r,0,0,r.width,r.height),e.output=e.output?e.output:"data",e.source=t,o.resize(e,a)}},_fileToCanvas:function(t,e,a){var r=this,o=new FileReader;o.onload=function(t){e.source=t.target.result,e.output||(e.output="file"),r.resize(e,a)},o.readAsDataURL(t)},_canvasToImageOrData:function(t,e,a,r,o){var n,i=t.toDataURL(e,a);return"data"===r?n=i:(n=new Image).src=t.toDataURL(e,a),"function"==typeof o?o(n):n},_mimeConverter:function(t){if(void 0===t)return"image/png";var e=["raw","png","jpg","gif","image/raw","image/png","image/jpg","image/gif"].indexOf(t);if(-1===e)throw Error("#inputImage() outputType can only be `raw`, `png`, `jpg` or `gif`");return 0===e||1===e?"image/png":2===e?"image/jpg":3===e?"image/gif":t},_download:function(t,e,a){return function(){var r=document.createElement("a");r.href=t._canvasToImageOrData(e,a.mimeType,a.quality,"data"),r.download="resized",document.body.appendChild(r),r.click(),document.body.removeChild(r)}},_workerBlobURL:function(t){t&&(t=this["_filter_"+t]),t||(t=this._filter_hermite);var e=this._workerTaskString(t);return window.URL.createObjectURL(new Blob([e],{type:"application/javascript"}))},_workerTaskString:function(t){var e="";return e+="(",e+="function () {",e+="    onmessage = function (event) {",e+="        var filter = ",e+=t.toString(),e+="        ;var resized = filter(event)",e+="        ;postMessage({data: resized });",e+="    };",(e+="}")+")()"},_filter_hermite:function(t){for(var e=t.data[0].data,a=t.data[1],r=t.data[2],o=t.data[3],n=t.data[4],i=t.data[5],u=i.data,f=a/o,c=r/n,d=Math.ceil(f/2),s=Math.ceil(c/2),g=0;g<n;g++)for(var p=0;p<o;p++){for(var l=4*(p+g*o),m=0,h=0,v=gx_g=gx_b=gx_a=0,y=(g+.5)*c,w=Math.floor(g*c);w<(g+1)*c;w++)for(var _=Math.abs(y-(w+.5))/s,b=(p+.5)*f,x=_*_,T=Math.floor(p*f);T<(p+1)*f;T++){var C=Math.abs(b-(T+.5))/d,I=Math.sqrt(x+C*C);I>=-1&&I<=1&&(m=2*I*I*I-3*I*I+1)>0&&(v+=m*e[C=4*(T+w*a)],gx_g+=m*e[C+1],gx_b+=m*e[C+2],gx_a+=m*e[C+3],h+=m)}u[l]=v/h,u[l+1]=gx_g/h,u[l+2]=gx_b/h,u[l+3]=gx_a/h}return i}};return Object.create(e)});