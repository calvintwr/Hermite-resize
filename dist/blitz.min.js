!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Blitz=t()}}(function(){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}var e={resize:function(e,o){if("object"!=t(e))throw Error("You need to provide options for Blitz as a `object`.");for(var r=this,a=["source","width","height"],n=0;n<a.length;n++){var i=a[n];if(void 0===e[i])throw Error("#resize() is expecting mandatory param `"+i+"`.")}if("function"!=typeof o)throw Error("#resize() is expecting `callback` to be a function.");var u,c,f=this._extract(e.source),g=this._mimeConverter(e.outputFormat);if(e.outputFormat=g,"CANVAS"===f.type)u=f.source;else if("IMG"===f.type)console.log("source type IMG"),u=this._imageToCanvas(f.source);else if("DATA"===f.type)return console.log("source type DATA"),e.output||(e.output="data"),this._fileToCanvas(f.source,e,o);if(!u)throw Error("Unable to detect source type.");e.logPerformance&&(c=Date.now());var s=u.width,d=u.height,l=Math.round(e.width),p=Math.round(e.height),h=u.getContext("2d").getImageData(0,0,s,d),m=u.getContext("2d").getImageData(0,0,l,p);u.getContext("2d").clearRect(0,0,s,d);var v=new Worker(this._workerBlobURL(e.filter));v.onmessage=function(t){console.log("worker done");var a=t.data.data;if(e.logPerformance&&console.log("Resize completed in "+Math.round(Date.now()-c)/1e3+"s"),u.getContext("2d").clearRect(0,0,l,p),u.height=p,u.width=l,u.getContext("2d").putImageData(a,0,0),"canvas"===e.output)return o(u);if(!(["image","data"].indexOf(e.output)>-1)){var n;if(void 0===e.output)return"FILE"===f.type?n="data":"IMG"===f.type&&(n="image"),n?r._canvasToImageOrData(u,e.mimeType,e.quality,n,o):o(u);throw Error("`output` is not valid.")}r._canvasToImageOrData(u,e.mimeType,e.quality,e.output,o)},v.postMessage([h,s,d,l,p,m])},create:function(t){if(!t||"promise"===t){var e=(o=Object.create(this)).resize.bind(o);return function(t){return new Promise(function(o,r){try{e(t,function(t){o(t)})}catch(a){r(a)}})}}var o;if("callback"===t)return(o=Object.create(this)).resize.bind(o)},_extract:function(t){if(t instanceof ProgressEvent)return{source:t.target.result,type:"DATA"};if("string"==typeof t&&0===t.indexOf("data"))return{source:t,type:"DATA"};if(t.tagName)return{source:t,type:t.tagName};if(t[0].tagName)return{source:t[0],type:t[0].tagName};throw Error("#resize() found `source` element to be invalid.")},_imageToCanvas:function(t){var e=document.createElement("canvas"),o=e.getContext("2d");return e.height=t.height,e.width=t.width,o.drawImage(t,0,0,t.width,t.height),e},_fileToCanvas:function(t,e,o){var r=new Image,a=this;r.src=t,r.onload=function(){console.log(r),console.log(r.height),console.log(r.width);var t=document.createElement("canvas"),n=t.getContext("2d");t.height=r.height,t.width=r.width,n.drawImage(r,0,0,r.width,r.height),e.output=e.output?e.output:"data",e.source=t,a.resize(e,o)}},_canvasToImageOrData:function(t,e,o,r,a){var n,i=t.toDataURL(e,o);return"data"===r?n=i:(console.log(890389),(n=new Image).src=t.toDataURL(e,o)),"function"==typeof a?a(n):n},_mimeConverter:function(t){if(void 0===t)return"image/png";var e=["raw","png","jpg","gif","image/raw","image/png","image/jpg","image/gif"].indexOf(t);if(-1===e)throw Error("#inputImage() outputType can only be `raw`, `png`, `jpg` or `gif`");return 0===e||1===e?"image/png":2===e?"image/jpg":3===e?"image/gif":t},_workerBlobURL:function(t){t&&(t=this["_filter_"+t]),t||(t=this._filter_hermite);var e=this._workerTaskString(t);return window.URL.createObjectURL(new Blob([e],{type:"application/javascript"}))},_workerTaskString:function(t){var e="";return e+="(",e+="function () {",e+="    onmessage = function (event) {",e+="        var filter = ",e+=t.toString(),e+="        ;var resized = filter(event)",e+="        ;postMessage({data: resized });",e+="    };",(e+="}")+")()"},_filter_hermite:function(t){for(var e=t.data[0].data,o=t.data[1],r=t.data[2],a=t.data[3],n=t.data[4],i=t.data[5],u=i.data,c=o/a,f=r/n,g=Math.ceil(c/2),s=Math.ceil(f/2),d=0;d<n;d++)for(var l=0;l<a;l++){for(var p=4*(l+d*a),h=0,m=0,v=gx_g=gx_b=gx_a=0,y=(d+.5)*f,w=Math.floor(d*f);w<(d+1)*f;w++)for(var b=Math.abs(y-(w+.5))/s,_=(l+.5)*c,x=b*b,T=Math.floor(l*c);T<(l+1)*c;T++){var I=Math.abs(_-(T+.5))/g,M=Math.sqrt(x+I*I);M>=-1&&M<=1&&(h=2*M*M*M-3*M*M+1)>0&&(v+=h*e[I=4*(T+w*o)],gx_g+=h*e[I+1],gx_b+=h*e[I+2],gx_a+=h*e[I+3],m+=h)}u[p]=v/m,u[p+1]=gx_g/m,u[p+2]=gx_b/m,u[p+3]=gx_a/m}return i}};return Object.create(e)});