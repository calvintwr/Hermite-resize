!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Blitz=e()}}(function(){var e={};function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}return(e=e={resize:function(e,a){if("object"!=t(e))throw Error("You need to provide options for Blitz as a `object`.");for(var r=this,o=["source","width","height"],i=0;i<o.length;i++){var n=o[i];if(void 0===e[n])throw Error("#resize() is expecting mandatory param `"+n+"`.")}if("function"!=typeof a)throw Error("#resize() is expecting `callback` to be a function.");var u,f,s=this._extract(e.source),d=this._mimeConverter(e.outputFormat);if(e.outputFormat=e.mimeType=d,"CANVAS"===s.type)u=s.source;else if("IMG"===s.type)u=this._imageToCanvas(s.source);else{if("DATA"===s.type)return e.output||(e.output="data"),this._dataToCanvas(s.source,e,a);if("FILE"===s.type)return e.output||(e.output="file"),this._fileToCanvas(s.source,e,a)}if(!u)throw Error("Unable to detect source type.");e.logPerformance&&(f=Date.now());var c=u.width,l=u.height,g=Math.round(e.width),p=Math.round(e.height),m=u.getContext("2d").getImageData(0,0,c,l),h=u.getContext("2d").getImageData(0,0,g,p);u.getContext("2d").clearRect(0,0,c,l);var v=new Worker(this._workerBlobURL(e.filter));v.onmessage=function(t){var o,i=new ImageData(new Uint8ClampedArray(t.data.data),g,p);if(e.logPerformance&&console.log("Resize completed in "+Math.round(Date.now()-f)/1e3+"s"),u.getContext("2d").clearRect(0,0,g,p),u.height=p,u.width=g,u.getContext("2d").putImageData(i,0,0),"canvas"===e.output)o=u;else if(["image","data"].indexOf(e.output)>-1)o=r._canvasToImageOrData(u,e.mimeType,e.quality,e.output);else if("file"===e.output)o=r._canvasToFile(u,e.mimeType,e.quality,e.output);else if("blob"===e.output)o=r._canvasToBlob(u,e.mimeType,e.quality,e.output);else if("download"===e.output)o=r._download(r,u,e);else{if(void 0!==e.output)throw Error("`output` is not valid.");var n;if("DATA"===s.type?n="data":"IMG"===s.type&&(n="image"),n)return r._canvasToImageOrData(u,e.mimeType,e.quality,n);o=u}a(o)},v.postMessage([m.data.buffer,c,l,g,p,h.data.buffer],[m.data.buffer,h.data.buffer])},create:function(e){if(!e||"promise"===e){var t=(a=Object.create(this)).resize.bind(a);return function(e){return new Promise(function(a,r){try{t(e,function(e){a(e)})}catch(o){r(o)}})}}var a;if("callback"===e)return(a=Object.create(this)).resize.bind(a)},_extract:function(e){if(e instanceof File)return{source:e,type:"FILE"};if("string"==typeof e&&0===e.indexOf("data"))return{source:e,type:"DATA"};if(e.tagName)return{source:e,type:e.tagName};if(e[0].tagName)return{source:e[0],type:e[0].tagName};throw Error("#resize() found `source` element to be invalid.")},_imageToCanvas:function(e){var t=document.createElement("canvas"),a=t.getContext("2d");return t.height=e.height,t.width=e.width,a.drawImage(e,0,0,e.width,e.height),t},_dataToCanvas:function(e,t,a){var r=new Image,o=this;r.src=e,r.onload=function(){var e=document.createElement("canvas"),i=e.getContext("2d");e.height=r.height,e.width=r.width,i.drawImage(r,0,0,r.width,r.height),t.output=t.output?t.output:"data",t.source=e,o.resize(t,a)}},_fileToCanvas:function(e,t,a){var r=this,o=new FileReader;o.onload=function(e){t.source=e.target.result,t.output||(t.output="file"),r.resize(t,a)},o.readAsDataURL(e)},_canvasToImageOrData:function(e,t,a,r){var o,i=e.toDataURL(t,a);return"data"===r?o=i:(o=new Image).src=e.toDataURL(t,a),o},_canvasToBlob:function(e,t,a,r){var o=this._canvasToImageOrData(e,t,a,"data");return this._dataURItoBlob(o)},_canvasToFile:function(e,t,a,r){var o=this._canvasToBlob(e,t,a);return new File([o],"resized",{type:t,lastModified:Date.now()})},_dataURItoBlob:function(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var a=e.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(t.length),o=0;o<t.length;o++)r[o]=t.charCodeAt(o);return new Blob([r],{type:a})},_mimeConverter:function(e){if(void 0===e)return"image/png";var t=["raw","png","jpg","gif","image/raw","image/png","image/jpg","image/gif"].indexOf(e);if(-1===t)throw Error("#inputImage() outputType can only be `raw`, `png`, `jpg` or `gif`");return 0===t||1===t?"image/png":2===t?"image/jpg":3===t?"image/gif":e},_download:function(e,t,a){return function(){var r=document.createElement("a");r.href=e._canvasToImageOrData(t,a.mimeType,a.quality,"data"),r.download="resized",document.body.appendChild(r),r.click(),document.body.removeChild(r)}},_workerBlobURL:function(e){e&&(e=this["_filter_"+e]),e||(e=this._filter_hermite);var t=this._workerTaskString(e);return window.URL.createObjectURL(new Blob([t],{type:"application/javascript"}))},_workerTaskString:function(e){var t="";return t+="(",t+="function () {",t+="    onmessage = function (event) {",t+="        var filter = ",t+=e.toString(),t+="        ;var resized = filter(event)",t+="        ;postMessage({data: resized }, [ resized ]);",t+="    };",(t+="}")+")()"},addFilter:function(e){var t="_filter_".concat(e.name);if(this[t])throw Error("Filter name already exist for ".concat(e.name,". Please use another name."));return this[t]=e.filter,this}}).addFilter({name:"hermite",filter:function(e){for(var t=new Uint8ClampedArray(e.data[0]),a=e.data[1],r=e.data[2],o=(new ImageData(t,a,r),new Uint8ClampedArray(e.data[5])),i=e.data[3],n=e.data[4],u=new ImageData(o,i,n),f=a/i,s=r/n,d=Math.ceil(f/2),c=Math.ceil(s/2),l=0;l<n;l++)for(var g=0;g<i;g++){for(var p=4*(g+l*i),m=0,h=0,v=gx_g=gx_b=gx_a=0,y=(l+.5)*s,w=Math.floor(l*s);w<(l+1)*s;w++)for(var b=Math.abs(y-(w+.5))/c,_=(g+.5)*f,T=b*b,x=Math.floor(g*f);x<(g+1)*f;x++){var C=Math.abs(_-(x+.5))/d,I=Math.sqrt(T+C*C);I>=-1&&I<=1&&(m=2*I*I*I-3*I*I+1)>0&&(v+=m*t[C=4*(x+w*a)],gx_g+=m*t[C+1],gx_b+=m*t[C+2],gx_a+=m*t[C+3],h+=m)}o[p]=v/h,o[p+1]=gx_g/h,o[p+2]=gx_b/h,o[p+3]=gx_a/h}return u.data.buffer}}),Object.create(e)});